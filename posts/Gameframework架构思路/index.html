<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate">
  <title>Gameframeworkæ¶æ„æ€è·¯ &middot; æ˜Ÿç©ºåŸä¸‹æ— å›ç‹</title>
  <meta name="keywords" content="æ˜Ÿç©ºåŸä¸‹æ— å›ç‹, GFæ•™ç¨‹, ETæ•™ç¨‹, XLuaæ•™ç¨‹, Unityæ¸¸æˆå¼€å‘æ•™ç¨‹">
  <meta name="description" content="DaveAntçš„æ¸¸æˆå¼€å‘åˆ†äº«ç«™">
  <meta name="author" content="DaveAnt">
  <link rel="icon" type="image/png" href="https://daveant.github.io/favicon.ico">
  <link rel="stylesheet" href="/css/diaspora.css">
  <link rel="stylesheet" href="/css/insight.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/waifu.css">
  <link rel="stylesheet" href="/css/qplayer.css">
  <link rel="stylesheet" href="/css/qplayer.init.css">
  <script src="/js/qplayer.js"></script>
  <script src="/js/qplayer.init.js"></script>  
</head>
<div class="waifu">
<div class="waifu-tips"></div>
<div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-top"></span>
    <span class="fui-chat"></span>
    <span class="fui-user"></span>
    <span class="fui-eye"></span>
    <span class="fui-cross"></span>
</div>
</div><body class="loading">
        <div id="loading"></div>
				<div id="nav"></div>
				<div class="nav-user"></div>
	
	
	
	
	
	
		<div class="toc-container" id="single">
		    <div class="toc">
				<aside class="toc-list">
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#%e5%89%8d%e8%a8%80">
				                            å‰è¨€
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#1%e5%a6%82%e4%bd%95%e4%b8%8b%e6%89%8b">
				                            1.å¦‚ä½•ä¸‹æ‰‹
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#2%e5%90%84%e5%a4%a7%e7%ae%a1%e7%90%86%e5%99%a8%e7%bb%84%e4%bb%b6%e5%8f%88%e6%98%af%e5%b9%b2%e5%98%9b%e7%9a%84">
				                            2.å„å¤§ç®¡ç†å™¨ç»„ä»¶åˆæ˜¯å¹²å˜›çš„ï¼Ÿ
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#3%e7%ae%a1%e7%90%86%e5%99%a8%e4%ba%8b%e4%bb%b6%e8%a7%a6%e5%8f%91%e6%9c%ba%e5%88%b6">
				                            3.ç®¡ç†å™¨äº‹ä»¶è§¦å‘æœºåˆ¶
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				</aside>
		    </div>
		</div>
	

    <div id="single">
    <div id="top" style="display: block;">
        <div class="bar">
        </div>
        <a title="è¿”å›é¦–é¡µ" class="icon-home" href="javascript:history.back()"></a>
        <div title="æ’­æ”¾/æš‚åœ" class="icon-play">
        </div>
        
        <h3 class="subtitle" style="display: none;">
        Gameframeworkæ¶æ„æ€è·¯</h3>
        <div class="social">
            <div>
                <div class="share">
                    <a title="æ‰“èµä½œè€…[å¾®ä¿¡]" class="icon-wechat" href="javascript:;"></a>
                    <a title="æ‰“èµä½œè€…[æ”¯ä»˜å®]" class="icon-alipay" href="javascript:;"></a>
                </div>
                <div id="wechatpay"> <img src="/img/inner/wechatpay.jpg"/> </div>
                <div id="alipay"> <img src="/img/inner/alipay.jpg"/> </div>
            </div>
        </div>
        <div class="scrollbar" style="width: 1.1636%;"></div>
    </div>
    <div class="section">
        <div class="article">
            <div style="background:transparent;background-color:rgba(255,255,255,0.8);">
                <h1 class="title">
                Gameframeworkæ¶æ„æ€è·¯</h1>
                <div class="stuff">
                    <span>March 1, 2020</span>
                    <span>å­—æ•° 7574</span>
                                  
                    <span id="/posts/Gameframeworkæ¶æ„æ€è·¯/" class="leancloud_visitors" data-flag-title="Gameframeworkæ¶æ„æ€è·¯">
                        <i class="leancloud-visitors-count">æé€Ÿæ¨¡å¼</i>
                    </span>
                    
                </div>
                <div class="content">
                    <!--cover: /img/title/Gameframework/wallhaven_22.jpg
cover: https://pics.images.ac.cn/image/5eb551871b924.html-->
<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>è¿™é‡ŒGFå°±æ˜¯Gameframeworkæ¡†æ¶,ä¿—è¯è¯´å¾—å¥½ä¸æƒ³æ‡‚åº•å±‚ä»£ç çš„ç¨‹åºçŒ¿,ä¸æ˜¯å¥½ç¨‹åºçŒ¿(é‚£é‡Œæ¥çš„ä¿—è¯,æˆ‘ä¹Ÿä¸çŸ¥é“&hellip;),Unityå¼•æ“å¦‚ä½•æ­å»ºçš„,ä¸æ‡‚å€’æ˜¯æ²¡æœ‰å…³ç³»,æ¯•ç«Ÿä»£ç æ²¡æœ‰å¼€æº(å°±ç®—å¼€æºäº†,æˆ‘ä¹Ÿä¸ä¼šå»è¯»çš„,æ¯•ç«Ÿåœ¨ä¸‹æ™ºå•†æœ‰é™),ä½†æ˜¯GFä»£ç æ˜¯ä¸ªäººè®¾è®¡åŸºäºUnityçš„æ¡†æ¶,ä½ ç”¨ç€å°è£…å¥½çš„åå…«å¤§é‡‘åˆš,æ•²ç€ç®€å•çš„ä»£ç ,è‰¯å¿ƒä¸ä¼šç—›å˜›,è€Œä¸”ä¸‡ä¸€æƒ³è¦å¾€æ¡†æ¶å°è£…æ–°æ¨¡å—,@ä½œè€…å»æ·»åŠ æ¨¡å—ä¹Ÿä¸å¤ªå¥½,æˆ‘ä»¬ä¹Ÿä¸æ˜¯è¿™æ ·çš„äºº,æ‰€ä»¥æ‰€ä»¥,è¿˜æ˜¯çœ‹ä¸€ä¸‹ä½œè€…è®¾è®¡æ¡†æ¶æ—¶çš„ç®€å•æ€è·¯ã€‚</p>
</blockquote>
<h2 id="1å¦‚ä½•ä¸‹æ‰‹">1.å¦‚ä½•ä¸‹æ‰‹</h2>
<p>æ¥è§¦GFå·®ä¸å¤šæœ‰ä¸€ä¸ªæœˆ,æœ¬æ¥å‡†å¤‡æ‹¿å®ƒé©¬ä¸Šç»ƒæ‰‹çš„,å»å†™ä¸€ä¸ªå°æ¸¸æˆå°è¯•ä¸€ä¸‹,ä½†æ˜¯çªç„¶æ€è€ƒè‰¯ä¹…,Â ä¸è¡Œï¼ä½œä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿,è¿æ¡†æ¶ä»£ç åŸç†éƒ½ä¸äº†è§£,è¿™ä¹ˆå¯ä»¥å¦‚æ­¤åŒ†å¿™çš„ä¸‹æ‰‹ï¼ˆä¸‡ä¸€å’Œå‚»å­ä¸€æ ·æ‰‹é‡Œå·²ç»æ‹¿ç€çœåŠ›æ æ†,ä½†è¿˜æ˜¯ç”¨æ‰‹å»ç¿˜çŸ³å¤´,è¿™æ ·ä¹Ÿä¸å¤ªå¥½ï¼‰,æ‰€ä»¥å‡†å¤‡æŠŠæ¯ä¸ªæ¨¡å—ä»”ä»”ç»†ç»†äº†è§£æ¸…æ¥š,ç„¶åæŠŠæ­å»ºGFæ¡†æ¶çš„æ€è·¯ä¹Ÿæ˜æ˜ç™½ç™½ç»™å¤§è„‘å®‰æ’ä¸€é,é‚£ä¸ªæ—¶å€™å†å»ä½¿ç”¨çœåŠ›æ æ†,å²‚ä¸æ˜¯ç”šå¥½ï¼ŸçŸ¥è¯†éƒ½æ˜¯é«˜æµ“åº¦è½¬å‘ä½æµ“åº¦çš„,æ‰€ä»¥åªè¦æŠŠè„‘è¢‹ç´§è´´ç€ç”µè„‘å±å¹•å°±å¯ä»¥æŠŠçŸ¥è¯†è½¬ç§»åˆ°è„‘å­é‡Œã€‚åœ¨å­¦ä¹ GFæ¡†æ¶å°½é‡è¦åšåˆ°ä¸€ä¸ªç›®æ ‡:ä½ çš„æ¡†æ¶å°±æ˜¯æˆ‘çš„æ¡†æ¶,æˆ‘çš„æ¡†æ¶è¿˜æ˜¯æˆ‘çš„æ¡†æ¶ã€‚
<img src="/img/post/Gameframework/summary/look1.png" alt="look1">
æ–‡å­—æ°´äº†è¿™ä¹ˆå¤šäº†,ç°åœ¨åº”è¯¥è®¨è®ºä¸€ä¸‹æ¡†æ¶åº”è¯¥å¦‚ä½•ä¸‹æ‰‹å­¦ä¹ ï¼Ÿå½“åœºæ•è·ä¸¤ä¸ªè„šæœ¬ï¼ˆGameFrameworkEntryå’ŒGameEntryï¼‰,å„ä½å¯ä»¥å…ˆä»GameFrameworkEntryè„šæœ¬,æ¯•ç«Ÿä½œè€…æŠŠå®ƒå¤‡æ³¨æˆæ¸¸æˆæ¡†æ¶å…¥å£,çœ‹çœ‹æ¸¸æˆæ¡†æ¶å…¥å£åˆ°åº•å†™äº†ä»€ä¹ˆé¬¼ï¼Ÿå…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> GameFramework
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// æ¸¸æˆæ¡†æ¶å…¥å£ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GameFrameworkEntry</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> GameFrameworkLinkedList&lt;GameFrameworkModule&gt; s_GameFrameworkModules = <span style="color:#66d9ef">new</span> GameFrameworkLinkedList&lt;GameFrameworkModule&gt;();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// æ‰€æœ‰æ¸¸æˆæ¡†æ¶æ¨¡å—è½®è¯¢ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;elapseSeconds&#34;&gt;é€»è¾‘æµé€æ—¶é—´,ä»¥ç§’ä¸ºå•ä½ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;realElapseSeconds&#34;&gt;çœŸå®æµé€æ—¶é—´,ä»¥ç§’ä¸ºå•ä½ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Update(<span style="color:#66d9ef">float</span> elapseSeconds, <span style="color:#66d9ef">float</span> realElapseSeconds)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span> (GameFrameworkModule module <span style="color:#66d9ef">in</span> s_GameFrameworkModules)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                module.Update(elapseSeconds, realElapseSeconds);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å…³é—­å¹¶æ¸…ç†æ‰€æœ‰æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Shutdown()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (LinkedListNode&lt;GameFrameworkModule&gt; current = s_GameFrameworkModules.Last; current != <span style="color:#66d9ef">null</span>; current = current.Previous)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                current.Value.Shutdown();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            s_GameFrameworkModules.Clear();
</span></span><span style="display:flex;"><span>            ReferencePool.ClearAll();
</span></span><span style="display:flex;"><span>            GameFrameworkLog.SetLogHelper(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;typeparam name=&#34;T&#34;&gt;è¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ç±»å‹ã€‚&lt;/typeparam&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;è¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;remarks&gt;å¦‚æœè¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ä¸å­˜åœ¨,åˆ™è‡ªåŠ¨åˆ›å»ºè¯¥æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚&lt;/remarks&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> T GetModule&lt;T&gt;() <span style="color:#66d9ef">where</span> T : <span style="color:#66d9ef">class</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Type interfaceType = <span style="color:#66d9ef">typeof</span>(T);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!interfaceType.IsInterface)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;You must get module by interface, but &#39;{0}&#39; is not.&#34;</span>, interfaceType.FullName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!interfaceType.FullName.StartsWith(<span style="color:#e6db74">&#34;GameFramework.&#34;</span>))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;You must get a Game Framework module, but &#39;{0}&#39; is not.&#34;</span>, interfaceType.FullName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span> moduleName = Utility.Text.Format(<span style="color:#e6db74">&#34;{0}.{1}&#34;</span>, interfaceType.Namespace, interfaceType.Name.Substring(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>            Type moduleType = Type.GetType(moduleName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (moduleType == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Can not find Game Framework module type &#39;{0}&#39;.&#34;</span>, moduleName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> GetModule(moduleType) <span style="color:#66d9ef">as</span> T;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;moduleType&#34;&gt;è¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ç±»å‹ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;è¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;remarks&gt;å¦‚æœè¦è·å–çš„æ¸¸æˆæ¡†æ¶æ¨¡å—ä¸å­˜åœ¨,åˆ™è‡ªåŠ¨åˆ›å»ºè¯¥æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚&lt;/remarks&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> GameFrameworkModule GetModule(Type moduleType)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span> (GameFrameworkModule module <span style="color:#66d9ef">in</span> s_GameFrameworkModules)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (module.GetType() == moduleType)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> module;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> CreateModule(moduleType);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åˆ›å»ºæ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;moduleType&#34;&gt;è¦åˆ›å»ºçš„æ¸¸æˆæ¡†æ¶æ¨¡å—ç±»å‹ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;è¦åˆ›å»ºçš„æ¸¸æˆæ¡†æ¶æ¨¡å—ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> GameFrameworkModule CreateModule(Type moduleType)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            GameFrameworkModule module = (GameFrameworkModule)Activator.CreateInstance(moduleType);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (module == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Can not create module &#39;{0}&#39;.&#34;</span>, moduleType.FullName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            LinkedListNode&lt;GameFrameworkModule&gt; current = s_GameFrameworkModules.First;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (current != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (module.Priority &gt; current.Value.Priority)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                current = current.Next;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (current != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                s_GameFrameworkModules.AddBefore(current, module);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                s_GameFrameworkModules.AddLast(module);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> module;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>é€šè¿‡è„šæœ¬å¯ä»¥è·å–åˆ°éœ€è¦çš„ç®¡ç†å™¨,å¹¶ä¸”ä¹Ÿæœ‰æ¡†æ¶æ¸…ç†é‡Šæ”¾å‡½æ•°ã€‚è¿˜æœ‰Updateå‡½æ•°å¯ä»¥è½®è¯¢æ¯ä¸ªç®¡ç†å™¨çš„æ›´æ–°å‡½æ•°,æœ‰æ²¡æœ‰å‘ç°è¿™ä¸ªç±»æ˜¯é™æ€çš„,è€Œä¸”åœ¨åŠ¨æ€é“¾æ¥åº“é‡Œçš„ã€‚æ‰€ä»¥å¤§èƒ†çŒœæµ‹ä¸€å®šæ˜¯æŸä¸ªè„šæœ¬ç»§æ‰¿äº†Monoè„šæœ¬é‡Œç„¶åå»è°ƒç”¨æ›´æ–°å‡½æ•°(è™½ç„¶æŸ¥çœ‹ä¸€ä¸‹Updateå‡½æ•°æ‰€æœ‰å¼•ç”¨å°±çŸ¥é“äº†),è¿™æ ·åŠ¨æ€é“¾æ¥åº“é‡Œçš„æ¯ä¸ªç®¡ç†å™¨éƒ½æ¥å…¥äº†æ›´æ–°æ–¹æ¡ˆã€‚GameFrameworkModuleåˆ—è¡¨æ˜¯å„ä½åœ¨æ¸¸æˆæ¡†æ¶å…¥å£ç±»é‡Œå¯ä»¥çœ‹åˆ°çš„,æ‰€ä»¥å¦‚æœæœ‰ä»€ä¹ˆå’Œæ¸¸æˆç›¸å…³çš„ç®¡ç†å™¨éœ€è¦æ‰©å±•æ—¶,å°±å¿…é¡»è¦ç»§æ‰¿GameFrameworkModuleæ‰å¯ä»¥,å¯ä»¥çœ‹ä¸€ä¸‹æ¡†æ¶æœ‰å“ªäº›ç±»æ˜¯ç»§æ‰¿äº†æ¨¡å—æŠ½è±¡ç±»çš„,å…·ä½“æˆªå›¾å¦‚ä¸‹:
<img src="/img/post/Gameframework/summary/exp1.png" alt="exp1">
ç›®æµ‹åå…«å¤§é‡‘é’¢éƒ½åœ¨,ä¸ºä»€ä¹ˆåå­—æœ‰å¦‚æ­¤å¤šé‡å¤ï¼Ÿå¦‚æœæœ‰è¿™ç§ç–‘é—®çš„ç«¥é´,å¯ä»¥å»çœ‹ä¸€ä¸‹partialé™å®šå­—ä½œç”¨,è¿™æ ·å°±å¯ä»¥çŸ¥é“å¦‚ä½•åšåˆ°æŠŠç±»ä»£ç åˆ†å¼€å®ç°çš„ã€‚è‡³äºä¸ºä»€ä¹ˆä½œè€…æŠŠè¿™äº›ç®¡ç†å™¨è„šæœ¬åˆ†æˆè¿™ä¹ˆå¤šä»½,å› ä¸ºç®¡ç†å™¨ä¸‹é¢æœ‰åˆ†æˆä¸€äº›åŠŸèƒ½,å¦‚æœæŠŠä»£ç å…¨éƒ¨é›†ä¸­åœ¨ä¸€èµ·å¤ªlow,è€Œä¸”ç±»ä»£ç å¯èƒ½åˆé•¿åˆå®½,Â å¯¼è‡´çœ‹èµ·æ¥å¾ˆä¸æ¸…æ™°ã€‚åƒæˆ‘è¿™ç§èœé¸Ÿä»¥å‰éƒ½æ˜¯é›†ä¸­èµ·æ¥,æ€‚ä»€ä¹ˆï¼Ÿå¹²å°±å®Œäº‹äº†ã€‚è¿˜æœ‰ä¸€ç‚¹è¦çŸ¥é“,å¦‚æœå¾€æ¡†æ¶æ·»åŠ æ¸¸æˆæ¨¡å—æ—¶,ç®¡ç†å™¨ä»£ç é›†ä¸­å†™é—®é¢˜å€’æ˜¯ä¸å¤§ã€‚ä½†æ˜¯æ·»åŠ æ–°æ¨¡å—æ—¶ä¸èƒ½å¼•ç”¨Unityç›¸å…³çš„åº“,å¦‚æœå‘ç°æ·»åŠ æ–°æ¨¡å—æ—¶å¼•ç”¨äº†Unityç›¸å…³åº“,åœ¨ä¸‹å°±é”¤çˆ†åœ¨åº§å„ä½çš„ç‹—å¤´ğŸ™„ã€‚
<img src="/img/post/Gameframework/summary/look2.jpg" alt="look2">
è¿™æ ·æ€ä¹ˆåŠå‘¢ï¼ŸåŠ¨æ€é“¾æ¥åº“ä»£ç å¦‚ä½•åšåˆ°ä¸Unityä¸­ä»£ç è¿›è¡Œå¯¹æ¥,å…¶å®æ¯ä¸ªç®¡ç†å™¨å¯ä»¥æœ‰å¾ˆå¤šä¸ªä»£ç†ç±»,æ¯”å¦‚èµ„æºç®¡ç†å™¨å¯ä»¥æœ‰å¾ˆå¤šä¸ªèµ„æºåŠ è½½ä»£ç†ç±»,ä¸‹è½½ç®¡ç†å™¨å¯ä»¥æœ‰å¾ˆå¤šä¸‹è½½ä»£ç†ç±»,å‘½åå·®ä¸å¤šæ˜¯xxxHelper,é€šä¿—çš„è¯´å®ƒä»¬çš„é¢†å¯¼å°±æ˜¯è¿™äº›ç®¡ç†å™¨,å„ä½åªéœ€è¦åœ¨åŠ¨æ€é“¾æ¥åº“é‡Œæ‹Ÿå®šä¸€ä¸‹æ¥å£,åœ¨Unityä¸­å…·ä½“å®ç°æ¥å£å³å¯,å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå„ä½å‚ç…§è®¾ç½®ç®¡ç†å™¨(SettingManager)å°±çŸ¥é“äº†,é¦–å…ˆè®¾ç½®ä»£ç†æ¥å£ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> GameFramework.Setting
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// æ¸¸æˆé…ç½®è¾…åŠ©å™¨æ¥å£ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ISettingHelper</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½æ¸¸æˆé…ç½®ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> Load();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä¿å­˜æ¸¸æˆé…ç½®ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> Save();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> HasSetting(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ç§»é™¤æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> RemoveSetting(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// æ¸…ç©ºæ‰€æœ‰æ¸¸æˆé…ç½®é¡¹ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> RemoveAllSettings();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¸ƒå°”å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> GetBool(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¸ƒå°”å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> GetBool(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">bool</span> defaultValue);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥å¸ƒå°”å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetBool(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–æ•´æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> GetInt(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–æ•´æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> GetInt(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">int</span> defaultValue);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥æ•´æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetInt(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–æµ®ç‚¹æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> GetFloat(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–æµ®ç‚¹æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> GetFloat(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">float</span> defaultValue);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥æµ®ç‚¹æ•°å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetFloat(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">float</span> <span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å­—ç¬¦ä¸²å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">string</span> GetString(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å­—ç¬¦ä¸²å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">string</span> GetString(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">string</span> defaultValue);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥å­—ç¬¦ä¸²å€¼ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetString(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        T GetObject&lt;T&gt;(<span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">object</span> GetObject(Type objectType, <span style="color:#66d9ef">string</span> settingName);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        T GetObject&lt;T&gt;(<span style="color:#66d9ef">string</span> settingName, T defaultObj);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// ä»æŒ‡å®šæ¸¸æˆé…ç½®é¡¹ä¸­è¯»å–å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">object</span> GetObject(Type objectType, <span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">object</span> defaultObj);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetObject&lt;T&gt;(<span style="color:#66d9ef">string</span> settingName, T obj);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å‘æŒ‡å®šæ¸¸æˆé…ç½®é¡¹å†™å…¥å¯¹è±¡ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> SetObject(<span style="color:#66d9ef">string</span> settingName, <span style="color:#66d9ef">object</span> obj);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™é‡Œè®¾ç½®ä»£ç†æ¥å£å°±æ˜¯åœ¨è¦æ‰“åŒ…æˆåŠ¨æ€é“¾æ¥åº“çš„è§£å†³æ–¹æ¡ˆé‡Œæ‹Ÿå®šçš„,å› ä¸ºæ¯ä¸ªç®¡ç†å™¨éƒ½éœ€è¦æŒæœ‰å®ƒä»¬çš„ä»£ç†ç±»,æ‰€ä»¥è®¾ç½®ç®¡ç†å™¨ç±»é‡Œä¸€å®šæœ‰çš„å‚æ•°å°±æ˜¯ISettingHelper SettingHelper,ç»§ç»­ï¼Ÿçœ‹çœ‹Unityä¸­å¦‚ä½•å®ç°ISettingHelperæ¥å£çš„,éƒ¨åˆ†ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SettingHelperBase</span> : MonoBehaviour, ISettingHelper
</span></span></code></pre></div><p>æ‰€ä»¥éœ€è¦æ·»åŠ å…¶ä»–è®¾ç½®æ–¹æ¡ˆæ—¶ï¼ˆæ¯”å¦‚å°†æœ¬åœ°è®¾ç½®ä¿å­˜æˆbyteæ–‡ä»¶ï¼‰,ç»§æ‰¿æ¥å£å¹¶ä¸”å»å®ç°å³å¯,ä½œè€…è¿™é‡Œé»˜è®¤å®ç°çš„è®¾ç½®ä»£ç†ç±»æ˜¯å¯¹Unityçš„PlayerPrefsçš„ä¸€å±‚å°è£…,å¦‚æ­¤å»è®¾è®¡GFç®€ç›´æ˜¯å¤©æ‰ä¹‹ä½œ(å…ˆæŠŠä½œè€…å¹ä¸€æ³¢),è¿™æ ·å°±å¯ä»¥å…·ä½“å®ç°åŠŸèƒ½çš„æ’æ‹”,æ¯”å¦‚æœ‰å¤©ä¸æƒ³ä½¿ç”¨PlayerPrefså»å®ç°è®¾ç½®æ¨¡å—ä¿å­˜æ•°æ®,è¿™æ ·å†é¢å¤–å®ç°ä¸€ä¸ªè®¾ç½®ä»£ç†ç±»å³å¯ã€‚
<img src="/img/post/Gameframework/summary/look3.png" alt="look3.png"></p>
<h2 id="2å„å¤§ç®¡ç†å™¨ç»„ä»¶åˆæ˜¯å¹²å˜›çš„">2.å„å¤§ç®¡ç†å™¨ç»„ä»¶åˆæ˜¯å¹²å˜›çš„ï¼Ÿ</h2>
<p>è¿™ä¸ªæ•…äº‹è¿˜æ˜¯ä»GameEntryè„šæœ¬å¼€å§‹å§ï¼ç›¯ç€ç”µè„‘å±å¹•åŠå¤©,æ„Ÿè§‰è¿™ä¸ªè„šæœ¬å’Œä¸Šé¢å¼€å§‹è¯´çš„é‚£ä¸ªè„šæœ¬ç®€ç›´ç¥ä¼¼ï¼Ÿï¼Ÿï¼Ÿåªä¸è¿‡è¿™ä¸ªè„šæœ¬åœ¨Unityè§£å†³æ–¹æ¡ˆé‡Œçš„,å¤šäº†æ³¨å†Œæ¨¡å—çš„å‡½æ•°,ç”¨æ¥å°†ç®¡ç†å™¨ç»„ä»¶æ·»åŠ åˆ°åˆ—è¡¨é‡Œ,ç¼ºå°‘äº†æ›´æ–°å‡½æ•°(æƒ³æƒ³ä¹Ÿå¯¹çš„,éƒ½æ˜¯åœ¨Unityä¸­çš„è§£å†³æ–¹æ¡ˆäº†,è¿˜è¦ä»€ä¹ˆæ›´æ–°å‡½æ•°ï¼Ÿ)ã€‚å› ä¸ºç»„ä»¶æ˜¯æŒ‚è½½åˆ°Unityå®é™…å¯¹è±¡ä¸Šçš„,æ‰€ä»¥GFæ¡†æ¶åœ¨Awakeæ—¶ç›´æ¥å»æ³¨å†Œäº†,è€ŒåŠ¨æ€é“¾æ¥åº“é‡Œæ˜¯è·å–ç®¡ç†å™¨æ—¶,å¦‚æœæ— æ³•æ‰¾åˆ°ç®¡ç†å™¨çš„è¯å°±é©¬ä¸Šåˆ›å»ºç®¡ç†å™¨ç„¶åä¿å­˜åˆ°åˆ—è¡¨é‡Œ,è¿˜æ˜¯æ¥çœ‹çœ‹ç»„ä»¶ä»¬æ˜¯å¦‚ä½•è¢«æ³¨å†Œå§,å…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> UnityGameFramework.Runtime
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// æ¸¸æˆæ¡†æ¶ç»„ä»¶æŠ½è±¡ç±»ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GameFrameworkComponent</span> : MonoBehaviour
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// æ¸¸æˆæ¡†æ¶ç»„ä»¶åˆå§‹åŒ–ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> Awake()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            GameEntry.RegisterComponent(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åªè¦ç®¡ç†å™¨ç»„ä»¶ç»§æ‰¿äº†ç»„ä»¶æŠ½è±¡ç±»æ—¶,å°±å¯ä»¥åœ¨Awakeæ—¶æ³¨å†Œåˆ°åˆ—è¡¨é‡Œ,å½“ç„¶å¦‚æœè¦é‡å†™Awakeå‡½æ•°æ—¶ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ ,ä½†æ˜¯è¦è®°ä½åœ¨Awakeå¼€å¤´è°ƒç”¨å†™ä¸Šä»¥ä¸‹ä»£ç :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">base</span>.Awake();
</span></span></code></pre></div><p>å¯èƒ½å„ä½ä¼šè¯´è¿™ä¸ªå°±ä¸å¿…å¤šè¯´äº†,è¿™ä¸ªä¸æ˜¯åŸºç¡€çŸ¥è¯†å˜›,é‚£ä¸ªé‚£ä¸ª&hellip;,å°±éšä¾¿æä¸€å˜´è€Œå·²,å„ä½æ¥ä¸‹æ¥å°±æ¥åˆ†æä¸€ä¸‹å„ä¸ªç®¡ç†å™¨ç»„ä»¶è„šæœ¬çš„å…·ä½“çš„ç”¨å¤„æ˜¯ä»€ä¹ˆï¼ŸåŠ¨æ€é“¾æ¥åº“é‡Œçš„ç®¡ç†å™¨æ€»éœ€è¦æœ‰å»è°ƒç”¨å’Œåˆå§‹åŒ–å‚æ•°çš„è„šæœ¬,è¿™ä¸ªæ—¶å€™å°±éœ€è¦åƒæœˆè€ç‰µçº¿ä¸€æ ·,å¤©ä¸‹æƒ…ä¾£éƒ½æ˜¯ä¸€å¯¹çš„(å¦‚æœä½ ä»¬æ•¢è¯´å›½å¤–æœ‰äº›åœ°æ–¹éƒ½å¯ä»¥ä¸€å¤«å¤šå¦»,æˆ‘åªèƒ½å¯¹å„ä½è¯´æ¸£ç”·ï¼),æ‰€ä»¥ä¸€ä¸ªç®¡ç†å™¨ç»„ä»¶å¯¹åº”ä¸Šä¸€ä¸ªç®¡ç†å™¨,æ¥çœ‹çœ‹è®¾ç½®ç®¡ç†å™¨ç»„ä»¶åˆ°åº•åšäº†ä»€ä¹ˆäº‹æƒ…,å…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> GameFramework.Resource;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> GameFramework.Scene
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// åœºæ™¯ç®¡ç†å™¨ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SceneManager</span> : GameFrameworkModule, ISceneManager
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;<span style="color:#66d9ef">string</span>&gt; m_LoadedSceneAssetNames;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;<span style="color:#66d9ef">string</span>&gt; m_LoadingSceneAssetNames;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> List&lt;<span style="color:#66d9ef">string</span>&gt; m_UnloadingSceneAssetNames;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> LoadSceneCallbacks m_LoadSceneCallbacks;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> UnloadSceneCallbacks m_UnloadSceneCallbacks;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> IResourceManager m_ResourceManager;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;LoadSceneSuccessEventArgs&gt; m_LoadSceneSuccessEventHandler;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;LoadSceneFailureEventArgs&gt; m_LoadSceneFailureEventHandler;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;LoadSceneUpdateEventArgs&gt; m_LoadSceneUpdateEventHandler;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;LoadSceneDependencyAssetEventArgs&gt; m_LoadSceneDependencyAssetEventHandler;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;UnloadSceneSuccessEventArgs&gt; m_UnloadSceneSuccessEventHandler;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> EventHandler&lt;UnloadSceneFailureEventArgs&gt; m_UnloadSceneFailureEventHandler;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åˆå§‹åŒ–åœºæ™¯ç®¡ç†å™¨çš„æ–°å®ä¾‹ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> SceneManager()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            m_LoadedSceneAssetNames = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            m_LoadingSceneAssetNames = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            m_UnloadingSceneAssetNames = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            m_LoadSceneCallbacks = <span style="color:#66d9ef">new</span> LoadSceneCallbacks(LoadSceneSuccessCallback, LoadSceneFailureCallback, LoadSceneUpdateCallback, LoadSceneDependencyAssetCallback);
</span></span><span style="display:flex;"><span>            m_UnloadSceneCallbacks = <span style="color:#66d9ef">new</span> UnloadSceneCallbacks(UnloadSceneSuccessCallback, UnloadSceneFailureCallback);
</span></span><span style="display:flex;"><span>            m_ResourceManager = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_LoadSceneSuccessEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_LoadSceneFailureEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_LoadSceneUpdateEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_LoadSceneDependencyAssetEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_UnloadSceneSuccessEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            m_UnloadSceneFailureEventHandler = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ¸¸æˆæ¡†æ¶æ¨¡å—ä¼˜å…ˆçº§ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;remarks&gt;ä¼˜å…ˆçº§è¾ƒé«˜çš„æ¨¡å—ä¼šä¼˜å…ˆè½®è¯¢,å¹¶ä¸”å…³é—­æ“ä½œä¼šåè¿›è¡Œã€‚&lt;/remarks&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">int</span> Priority
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">60</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯æˆåŠŸäº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;LoadSceneSuccessEventArgs&gt; LoadSceneSuccess
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneSuccessEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneSuccessEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯å¤±è´¥äº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;LoadSceneFailureEventArgs&gt; LoadSceneFailure
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneFailureEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneFailureEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯æ›´æ–°äº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;LoadSceneUpdateEventArgs&gt; LoadSceneUpdate
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneUpdateEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneUpdateEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯æ—¶åŠ è½½ä¾èµ–èµ„æºäº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;LoadSceneDependencyAssetEventArgs&gt; LoadSceneDependencyAsset
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneDependencyAssetEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_LoadSceneDependencyAssetEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å¸è½½åœºæ™¯æˆåŠŸäº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;UnloadSceneSuccessEventArgs&gt; UnloadSceneSuccess
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_UnloadSceneSuccessEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_UnloadSceneSuccessEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å¸è½½åœºæ™¯å¤±è´¥äº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;UnloadSceneFailureEventArgs&gt; UnloadSceneFailure
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">add</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_UnloadSceneFailureEventHandler += <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">remove</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                m_UnloadSceneFailureEventHandler -= <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åœºæ™¯ç®¡ç†å™¨è½®è¯¢ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;elapseSeconds&#34;&gt;é€»è¾‘æµé€æ—¶é—´,ä»¥ç§’ä¸ºå•ä½ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;realElapseSeconds&#34;&gt;çœŸå®æµé€æ—¶é—´,ä»¥ç§’ä¸ºå•ä½ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Update(<span style="color:#66d9ef">float</span> elapseSeconds, <span style="color:#66d9ef">float</span> realElapseSeconds)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å…³é—­å¹¶æ¸…ç†åœºæ™¯ç®¡ç†å™¨ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Shutdown()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span>[] loadedSceneAssetNames = m_LoadedSceneAssetNames.ToArray();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">string</span> loadedSceneAssetName <span style="color:#66d9ef">in</span> loadedSceneAssetNames)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (SceneIsUnloading(loadedSceneAssetName))
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                UnloadScene(loadedSceneAssetName);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            m_LoadedSceneAssetNames.Clear();
</span></span><span style="display:flex;"><span>            m_LoadingSceneAssetNames.Clear();
</span></span><span style="display:flex;"><span>            m_UnloadingSceneAssetNames.Clear();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è®¾ç½®èµ„æºç®¡ç†å™¨ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;resourceManager&#34;&gt;èµ„æºç®¡ç†å™¨ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> SetResourceManager(IResourceManager resourceManager)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (resourceManager == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Resource manager is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            m_ResourceManager = resourceManager;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–åœºæ™¯æ˜¯å¦å·²åŠ è½½ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;åœºæ™¯æ˜¯å¦å·²åŠ è½½ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> SceneIsLoaded(<span style="color:#66d9ef">string</span> sceneAssetName)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Scene asset name is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_LoadedSceneAssetNames.Contains(sceneAssetName);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–å·²åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;å·²åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] GetLoadedSceneAssetNames()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_LoadedSceneAssetNames.ToArray();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–å·²åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;results&#34;&gt;å·²åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> GetLoadedSceneAssetNames(List&lt;<span style="color:#66d9ef">string</span>&gt; results)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (results == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Results is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            results.Clear();
</span></span><span style="display:flex;"><span>            results.AddRange(m_LoadedSceneAssetNames);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–åœºæ™¯æ˜¯å¦æ­£åœ¨åŠ è½½ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;åœºæ™¯æ˜¯å¦æ­£åœ¨åŠ è½½ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> SceneIsLoading(<span style="color:#66d9ef">string</span> sceneAssetName)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Scene asset name is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_LoadingSceneAssetNames.Contains(sceneAssetName);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ­£åœ¨åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;æ­£åœ¨åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] GetLoadingSceneAssetNames()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_LoadingSceneAssetNames.ToArray();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ­£åœ¨åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;results&#34;&gt;æ­£åœ¨åŠ è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> GetLoadingSceneAssetNames(List&lt;<span style="color:#66d9ef">string</span>&gt; results)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (results == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Results is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            results.Clear();
</span></span><span style="display:flex;"><span>            results.AddRange(m_LoadingSceneAssetNames);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–åœºæ™¯æ˜¯å¦æ­£åœ¨å¸è½½ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;åœºæ™¯æ˜¯å¦æ­£åœ¨å¸è½½ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> SceneIsUnloading(<span style="color:#66d9ef">string</span> sceneAssetName)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Scene asset name is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_UnloadingSceneAssetNames.Contains(sceneAssetName);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ­£åœ¨å¸è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;returns&gt;æ­£åœ¨å¸è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] GetUnloadingSceneAssetNames()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> m_UnloadingSceneAssetNames.ToArray();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// è·å–æ­£åœ¨å¸è½½åœºæ™¯çš„èµ„æºåç§°ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;results&#34;&gt;æ­£åœ¨å¸è½½åœºæ™¯çš„èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> GetUnloadingSceneAssetNames(List&lt;<span style="color:#66d9ef">string</span>&gt; results)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (results == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Results is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            results.Clear();
</span></span><span style="display:flex;"><span>            results.AddRange(m_UnloadingSceneAssetNames);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> LoadScene(<span style="color:#66d9ef">string</span> sceneAssetName)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            LoadScene(sceneAssetName, Constant.DefaultPriority, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;priority&#34;&gt;åŠ è½½åœºæ™¯èµ„æºçš„ä¼˜å…ˆçº§ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> LoadScene(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">int</span> priority)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            LoadScene(sceneAssetName, priority, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;userData&#34;&gt;ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> LoadScene(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            LoadScene(sceneAssetName, Constant.DefaultPriority, userData);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// åŠ è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;priority&#34;&gt;åŠ è½½åœºæ™¯èµ„æºçš„ä¼˜å…ˆçº§ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;userData&#34;&gt;ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> LoadScene(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">int</span> priority, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Scene asset name is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_ResourceManager == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;You must set resource manager first.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (SceneIsUnloading(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is being unloaded.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (SceneIsLoading(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is being loaded.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (SceneIsLoaded(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is already loaded.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            m_LoadingSceneAssetNames.Add(sceneAssetName);
</span></span><span style="display:flex;"><span>            m_ResourceManager.LoadScene(sceneAssetName, priority, m_LoadSceneCallbacks, userData);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å¸è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> UnloadScene(<span style="color:#66d9ef">string</span> sceneAssetName)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            UnloadScene(sceneAssetName, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// å¸è½½åœºæ™¯ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;sceneAssetName&#34;&gt;åœºæ™¯èµ„æºåç§°ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;userData&#34;&gt;ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ã€‚&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> UnloadScene(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;Scene asset name is invalid.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_ResourceManager == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(<span style="color:#e6db74">&#34;You must set resource manager first.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (SceneIsUnloading(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is being unloaded.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (SceneIsLoading(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is being loaded.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!SceneIsLoaded(sceneAssetName))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Scene asset &#39;{0}&#39; is not loaded yet.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            m_UnloadingSceneAssetNames.Add(sceneAssetName);
</span></span><span style="display:flex;"><span>            m_ResourceManager.UnloadScene(sceneAssetName, m_UnloadSceneCallbacks, userData);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> LoadSceneSuccessCallback(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">float</span> duration, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            m_LoadingSceneAssetNames.Remove(sceneAssetName);
</span></span><span style="display:flex;"><span>            m_LoadedSceneAssetNames.Add(sceneAssetName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_LoadSceneSuccessEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                LoadSceneSuccessEventArgs loadSceneSuccessEventArgs = LoadSceneSuccessEventArgs.Create(sceneAssetName, duration, userData);
</span></span><span style="display:flex;"><span>                m_LoadSceneSuccessEventHandler(<span style="color:#66d9ef">this</span>, loadSceneSuccessEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(loadSceneSuccessEventArgs);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> LoadSceneFailureCallback(<span style="color:#66d9ef">string</span> sceneAssetName, LoadResourceStatus status, <span style="color:#66d9ef">string</span> errorMessage, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            m_LoadingSceneAssetNames.Remove(sceneAssetName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span> appendErrorMessage = Utility.Text.Format(<span style="color:#e6db74">&#34;Load scene failure, scene asset name &#39;{0}&#39;, status &#39;{1}&#39;, error message &#39;{2}&#39;.&#34;</span>, sceneAssetName, status.ToString(), errorMessage);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_LoadSceneFailureEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                LoadSceneFailureEventArgs loadSceneFailureEventArgs = LoadSceneFailureEventArgs.Create(sceneAssetName, appendErrorMessage, userData);
</span></span><span style="display:flex;"><span>                m_LoadSceneFailureEventHandler(<span style="color:#66d9ef">this</span>, loadSceneFailureEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(loadSceneFailureEventArgs);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(appendErrorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> LoadSceneUpdateCallback(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">float</span> progress, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_LoadSceneUpdateEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                LoadSceneUpdateEventArgs loadSceneUpdateEventArgs = LoadSceneUpdateEventArgs.Create(sceneAssetName, progress, userData);
</span></span><span style="display:flex;"><span>                m_LoadSceneUpdateEventHandler(<span style="color:#66d9ef">this</span>, loadSceneUpdateEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(loadSceneUpdateEventArgs);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> LoadSceneDependencyAssetCallback(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">string</span> dependencyAssetName, <span style="color:#66d9ef">int</span> loadedCount, <span style="color:#66d9ef">int</span> totalCount, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_LoadSceneDependencyAssetEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                LoadSceneDependencyAssetEventArgs loadSceneDependencyAssetEventArgs = LoadSceneDependencyAssetEventArgs.Create(sceneAssetName, dependencyAssetName, loadedCount, totalCount, userData);
</span></span><span style="display:flex;"><span>                m_LoadSceneDependencyAssetEventHandler(<span style="color:#66d9ef">this</span>, loadSceneDependencyAssetEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(loadSceneDependencyAssetEventArgs);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> UnloadSceneSuccessCallback(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            m_UnloadingSceneAssetNames.Remove(sceneAssetName);
</span></span><span style="display:flex;"><span>            m_LoadedSceneAssetNames.Remove(sceneAssetName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_UnloadSceneSuccessEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                UnloadSceneSuccessEventArgs unloadSceneSuccessEventArgs = UnloadSceneSuccessEventArgs.Create(sceneAssetName, userData);
</span></span><span style="display:flex;"><span>                m_UnloadSceneSuccessEventHandler(<span style="color:#66d9ef">this</span>, unloadSceneSuccessEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(unloadSceneSuccessEventArgs);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> UnloadSceneFailureCallback(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            m_UnloadingSceneAssetNames.Remove(sceneAssetName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m_UnloadSceneFailureEventHandler != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                UnloadSceneFailureEventArgs unloadSceneFailureEventArgs = UnloadSceneFailureEventArgs.Create(sceneAssetName, userData);
</span></span><span style="display:flex;"><span>                m_UnloadSceneFailureEventHandler(<span style="color:#66d9ef">this</span>, unloadSceneFailureEventArgs);
</span></span><span style="display:flex;"><span>                ReferencePool.Release(unloadSceneFailureEventArgs);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(Utility.Text.Format(<span style="color:#e6db74">&#34;Unload scene failure, scene asset name &#39;{0}&#39;.&#34;</span>, sceneAssetName));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>çœ‹æ¥ç»„ä»¶åšçš„äº‹æƒ…ä¹Ÿä¸å°‘,åŠ¨æ€é“¾æ¥åº“é‡Œç®¡ç†å™¨æŒæœ‰ä»£ç†å¯¹è±¡,è€Œç®¡ç†å™¨ç»„ä»¶æŒæœ‰ç€ç®¡ç†å™¨å¯¹è±¡,å¯èƒ½æœ‰äº›äººä¼šè¯´ä¸ºä»€ä¹ˆå°±ä¸€å®šè¦ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“é‡Œå»è°ƒç”¨,å°±ä¸èƒ½åœ¨Unityè§£å†³æ–¹æ¡ˆé‡Œç›´æ¥å†™å˜›ï¼Ÿå¯ä»¥æ˜¯å¯ä»¥,ä½†æ˜¯ä¸»è¦çš„ä»£ç å†™åˆ°åŠ¨æ€é“¾æ¥é‡Œ,æ€§èƒ½æ–¹é¢ä¼šæ›´åŠ å¥½,ç®¡ç†å™¨ç»„ä»¶æŒæœ‰ç®¡ç†å™¨å»è°ƒç”¨æ–¹æ³•å³å¯ã€‚ç»™å¤§å®¶ç”»ä¸ªæ¯”è¾ƒç®€å•çš„GFæ¶æ„å›¾,è®©å„ä½æ›´å¥½çš„ç†è§£è®¾è®¡æ€è·¯ã€‚ç»“æ„æ€è·¯å›¾å¦‚ä¸‹:
<img src="/img/post/Gameframework/summary/exp2.png" alt="exp2">
è¿™æ ·éœ€è¦æ·»åŠ æ–°ç®¡ç†å™¨æ—¶,å°±å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ€è·¯å»è®¾è®¡äº†,æ­¦æ—ç§˜ç±å·²ç»å€¾å›Šä¼ æˆç»™å„ä½äº†,æ¥ä¸‹æ¥å„ä½å»çœ‹çœ‹åå…«æ¨¡å—çš„äº‹ä»¶æ˜¯å¦‚ä½•è§¦å‘èµ·æ¥çš„,æ¯”å¦‚è®¾ç½®æˆåŠŸä»¥åéœ€è¦æœ‰ä¸€ä¸ªæˆåŠŸçš„å›è°ƒå‡½æ•°ã€‚</p>
<h2 id="3ç®¡ç†å™¨äº‹ä»¶è§¦å‘æœºåˆ¶">3.ç®¡ç†å™¨äº‹ä»¶è§¦å‘æœºåˆ¶</h2>
<p>æ¯ä¸ªç®¡ç†å™¨éƒ½éœ€è¦æœ‰ä¸€å®šå›è°ƒå‡½æ•°,é€šçŸ¥å®ƒæ˜¯å¦æˆåŠŸçš„å›è°ƒ,æˆåŠŸæˆ–å¤±è´¥ä¹‹åæ€»éœ€è¦å¹²ç‚¹ä»€ä¹ˆäº‹æƒ…,åœ¨ç®¡ç†å™¨ç»„ä»¶é‡Œå¯¥å¯¥æ— å‡ çš„äº‹ä»¶ä»£ç ,åªéœ€è¦åœ¨Awakeé‡Œç»™å®ƒæ·»åŠ åˆ°ä¸€ä¸ªå¤šæ’­äº‹ä»¶é‡Œå³å¯,ä»¥åœºæ™¯ç®¡ç†å™¨ç»„ä»¶(SceneComponent)ä½œä¸ºä¾‹å­,å…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>    m_SceneManager.LoadSceneSuccess += OnLoadSceneSuccess;
</span></span><span style="display:flex;"><span>    m_SceneManager.LoadSceneFailure += OnLoadSceneFailure;
</span></span></code></pre></div><p>æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨çœ‹ä¸€ä¸‹åˆ°åº•é‚£é‡Œè°ƒç”¨è¿™ä¸ªå¤šæ’­äº‹ä»¶,å…ˆç»™å„ä½æˆªä¸ªå›¾å§,æ¯•ç«Ÿè¿™ä¸ªç®—æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹äº†,è¯¸å›è¯·çœ‹ä¸‹å›¾:
<img src="/img/post/Gameframework/summary/exp3.png" alt="exp3">
å¯ä»¥çœ‹åˆ°äº‹ä»¶çš„å›è°ƒæ—¶æ”¾åˆ°è¿™ä¸ªå‡½æ•°é‡Œäº†,ä½†æ˜¯å…·ä½“è¿™ä¸ªå‡½æ•°åœ¨é‚£é‡Œè°ƒç”¨å‘¢ï¼Ÿè®©æˆ‘ä»¬ç»§ç»­æŸ¥æ‰¾ä¸€ä¸‹å¼•ç”¨,å‘ç°ä¸€ä¸ªäº‹ä»¶ç®¡ç†å™¨æŠŠæ‰€æœ‰å›è°ƒå‡½æ•°å…¨éƒ¨å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œäº†,å…·ä½“ä»£ç æ®µå¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>m_LoadSceneCallbacks = <span style="color:#66d9ef">new</span> LoadSceneCallbacks(LoadSceneSuccessCallback, LoadSceneFailureCallback, LoadSceneUpdateCallback, LoadSceneDependencyAssetCallback);
</span></span></code></pre></div><p>æ‰€ä»¥éœ€è¦æ‰¾åˆ°m_LoadSceneCallbackså¯¹è±¡å¼•ç”¨å³å¯,æœ€åçš„æœ€åï¼ï¼ï¼å¯ä»¥å‘ç°çš„æ˜¯æŠŠå¯¹è±¡äº¤ç»™ä»»åŠ¡æ± ç®¡ç†å™¨äº†,æ·»åŠ åˆ°ä»»åŠ¡ç®¡ç†æ± é‡Œé¢,å¤§æ¦‚æ˜¯æ”¾åˆ°ç±»ä¼¼åˆ—è¡¨çš„æ•°æ®ç»“æ„é‡Œè¿›è¡Œè½®å›,å…ˆç»™å„ä½çœ‹ä¸€ä¸‹è·³è½¬åˆ°çš„æ·»åŠ åˆ°ä»»åŠ¡æ± çš„ä»£ç æ®µã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> LoadScene(<span style="color:#66d9ef">string</span> sceneAssetName, <span style="color:#66d9ef">int</span> priority, LoadSceneCallbacks loadSceneCallbacks, <span style="color:#66d9ef">object</span> userData)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ResourceInfo? resourceInfo = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">string</span>[] dependencyAssetNames = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (!CheckAsset(sceneAssetName, <span style="color:#66d9ef">out</span> resourceInfo, <span style="color:#66d9ef">out</span> dependencyAssetNames))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span> errorMessage = Utility.Text.Format(<span style="color:#e6db74">&#34;Can not load scene &#39;{0}&#39;.&#34;</span>, sceneAssetName);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (loadSceneCallbacks.LoadSceneFailureCallback != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                loadSceneCallbacks.LoadSceneFailureCallback(sceneAssetName, LoadResourceStatus.NotReady, errorMessage, userData);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(errorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        LoadSceneTask mainTask = LoadSceneTask.Create(sceneAssetName, priority, resourceInfo.Value, dependencyAssetNames, loadSceneCallbacks, userData);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">string</span> dependencyAssetName <span style="color:#66d9ef">in</span> dependencyAssetNames)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!LoadDependencyAsset(dependencyAssetName, priority, mainTask, userData))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">string</span> errorMessage = Utility.Text.Format(<span style="color:#e6db74">&#34;Can not load dependency asset &#39;{0}&#39; when load scene &#39;{1}&#39;.&#34;</span>, dependencyAssetName, sceneAssetName);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (loadSceneCallbacks.LoadSceneFailureCallback != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    loadSceneCallbacks.LoadSceneFailureCallback(sceneAssetName, LoadResourceStatus.DependencyError, errorMessage, userData);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GameFrameworkException(errorMessage);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        m_TaskPool.AddTask(mainTask);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>è‡³äºTaskPoolé‡Œä»£ç ç¡®å®æ˜¯åœ¨Updateé‡Œæ‰§è¡Œ,ä»»åŠ¡æ± ä¸æ–­çš„æ›´æ–°,æ‰§è¡Œä»»åŠ¡ä»¥åå°±æŠŠä»»åŠ¡å¯¹è±¡ä»åˆ—è¡¨é‡Œç§»é™¤,ç»™å„ä½çœ‹ä¸€ä¸‹ä»»åŠ¡æ± çš„Updateé‡Œæ˜¯å¦‚ä½•æ‰§è¡Œçš„,è°ƒç”¨æˆªå›¾å¦‚ä¸‹:
<img src="/img/post/Gameframework/summary/exp4.png" alt="exp4">
è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä»¥å,å®é™…è°ƒç”¨çš„å‡½æ•°æ˜¯é€šè¿‡ProcessRunningTasks,è¿™é‡Œåˆæœ‰ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ä»»åŠ¡ä»£ç†ç±»,è¯´èµ·æ¥æœ‰ç‚¹ç¹ç,è¿™é‡Œå°±å…ˆç®€å•çš„ç”»é¾™ç‚¹ç›ä¸€ä¸‹,å…·ä½“çš„è°ƒç”¨åŸç†å¯ä»¥çœ‹ä¸€ä¸‹åœ¨ä¸‹å†™çš„ä»»åŠ¡æ± åŸç†åˆ†æ,é¦–å…ˆç»™å„ä½çœ‹çœ‹ProcessRunningTaskså‡½æ•°åˆ°åº•åšäº†é‚£äº›äº‹æƒ…å§ï¼å…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> ProcessRunningTasks(<span style="color:#66d9ef">float</span> elapseSeconds, <span style="color:#66d9ef">float</span> realElapseSeconds)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        LinkedListNode&lt;ITaskAgent&lt;T&gt;&gt; current = m_WorkingAgents.First;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (current != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            T task = current.Value.Task;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!task.Done)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                current.Value.Update(elapseSeconds, realElapseSeconds);
</span></span><span style="display:flex;"><span>                current = current.Next;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            LinkedListNode&lt;ITaskAgent&lt;T&gt;&gt; next = current.Next;
</span></span><span style="display:flex;"><span>            current.Value.Reset();
</span></span><span style="display:flex;"><span>            m_FreeAgents.Push(current.Value);
</span></span><span style="display:flex;"><span>            m_WorkingAgents.Remove(current);
</span></span><span style="display:flex;"><span>            ReferencePool.Release(task);
</span></span><span style="display:flex;"><span>            current = next;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>åˆ°è¿™é‡Œçš„current.Value.Updateå°±æ˜¯è°ƒåˆ°ç®¡ç†å™¨éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°(m_LoadSceneCallbacks),å„ä½æ˜¯ä¸æ˜¯æ…¢æ…¢å¿˜è®°äº†æ ‡é¢˜&hellip;å¥½åƒè¿™ä¹ˆè°ƒç€è°ƒç€,ä»£ç å°±è®²åˆ°è¿™é‡Œäº†,ä¸è¦æƒŠæ…Œï¼åªéœ€è¦çœ‹è¿‡ä»»åŠ¡æ± æ–‡ç« ,ä½ çš„æ€è·¯å°±ä¼šæ¸æ¸æ¸…æ¥šäº†(è™½ç„¶å†™è¿™ç¯‡æ–‡ç« æ—¶,ä»»åŠ¡æ± æ–‡ç« è¿˜æ²¡æœ‰å¼€å§‹å†™,å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ)ã€‚
<img src="/img/post/Gameframework/summary/look4.jpg" alt="look4">
è¿™é‡ŒUpdateå‡½æ•°å…·ä½“è°ƒç”¨ä»£ç ç»™å„ä½çœ‹ä¸€ä¸‹,å…·ä½“æ˜¯åœ¨DefaultLoadResourceAgentHelperé‡Œ,å¦‚å›¾æ‰€ç¤º:
<img src="/img/post/Gameframework/summary/exp5.png" alt="exp5">
åˆ°è¿™é‡Œç®—æ˜¯ç»“æŸäº†&hellip;è¿˜æœ‰ä¸€ç‚¹å·®ç‚¹å¿˜è®°äº†,å°±æ˜¯è°ƒç”¨åŠå¤©äº†,å…¶å®å›è°ƒå‡½æ•°é‡Œåªæ˜¯è°ƒç”¨m_EventComponent.Fireå‡½æ•°,è¿™ä¸ªå‡½æ•°åˆæ˜¯ä»€ä¹ˆä½œç”¨ï¼Ÿå„ä½å¯ä»¥åˆ°<a href="https://blog.csdn.net/m0_37920739/article/details/104723210">GFäº‹ä»¶åŸç†ä¼ é€é—¨</a>å»çœ‹çœ‹ã€‚</p>

                    <audio id="audio" loop="1" preload="auto" style="width: 100%;" controls="controls">
                        <source type="audio/mpeg" src="/mp3/%e5%a5%b9%e6%9b%be%e6%b4%bb%e8%bf%87%e5%95%8a.mp3">
                        <a href="/mp3/%e5%a5%b9%e6%9b%be%e6%b4%bb%e8%bf%87%e5%95%8a.mp3">/mp3/å¥¹æ›¾æ´»è¿‡å•Š.mp3</a>
                    </audio>
                </div>
            </div>
        </div>
    </div>
    <div class="relate">
        <ul >
            <h3 id="prev_next">
                <em>ç›¸ å…³ æ–‡ ç« </em>
                <span>
                    <a href="javascript: window.scrollTo(0, 0);">
                    è¿”å›é¡¶éƒ¨</a>
                    
                        <a href="https://daveant.github.io/posts/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" rel="prev">ä¸Šä¸€ç¯‡</a>
                    
                    
                        <a href="https://daveant.github.io/posts/%E8%BF%87%E6%BB%A4%E5%99%A8%E6%A8%A1%E5%BC%8F/" rel="next">ä¸‹ä¸€ç¯‡</a>
                    
                </span>
            </h3>
            
            
            
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Gameframework-TaskPool%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-TaskPoolåˆæ¢ç¯‡">
                            Gameframework-TaskPoolåˆæ¢ç¯‡</a>
                            <p>æ„æ€ä¸­&hellip;...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Gameframework-TaskPool%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-TaskPoolåˆæ¢ç¯‡">
                            <img class="relateimg" src="/img/title/Gameframework/wallhaven_19.jpg" alt="Gameframework-TaskPoolåˆæ¢ç¯‡">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Gameframework-Scene%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-Sceneåˆæ¢ç¯‡">
                            Gameframework-Sceneåˆæ¢ç¯‡</a>
                            <p>å‰è¨€ Sceneæ˜¯ç‰¹æ®Šçš„èµ„æº,åŠ è½½åœºæ™¯æ—¶ä¼šç”¨åˆ°Unityè‡ªå¸¦çš„SceneManagerå®ç°åœºæ™¯åŠ è½½,S...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Gameframework-Scene%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-Sceneåˆæ¢ç¯‡">
                            <img class="relateimg" src="/img/title/Gameframework/wallhaven_17.jpg" alt="Gameframework-Sceneåˆæ¢ç¯‡">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Gameframework-Config%E8%BF%9B%E9%98%B6%E7%AF%87/" title="Gameframework-Configè¿›é˜¶ç¯‡">
                            Gameframework-Configè¿›é˜¶ç¯‡</a>
                            <p>å‰è¨€ åˆæ¢ç¯‡åˆ†æäº†é‡å†™é…ç½®æ¨¡å—çš„æ€è·¯,æŒ‰ç…§ä¹‹å‰åˆ†æçš„æ€è·¯å°è¯•é‡å†™é…ç½®æ¨¡å—,ç„¶åä¸ºGFé…ç½®æ¨¡å—æ·»åŠ xls...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Gameframework-Config%E8%BF%9B%E9%98%B6%E7%AF%87/" title="Gameframework-Configè¿›é˜¶ç¯‡">
                            <img class="relateimg" src="/img/title/Gameframework/wallhaven_13.jpg" alt="Gameframework-Configè¿›é˜¶ç¯‡">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Gameframework-Resource%E7%83%AD%E6%9B%B4%E6%96%B0/" title="Gameframework-Resourceçƒ­æ›´æ–°">
                            Gameframework-Resourceçƒ­æ›´æ–°</a>
                            <p>æ­£åœ¨æ„æ€ä¸­&hellip;...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Gameframework-Resource%E7%83%AD%E6%9B%B4%E6%96%B0/" title="Gameframework-Resourceçƒ­æ›´æ–°">
                            <img class="relateimg" src="/img/title/Gameframework/wallhaven_14.jpg" alt="Gameframework-Resourceçƒ­æ›´æ–°">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Gameframework-Config%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-Configåˆæ¢ç¯‡">
                            Gameframework-Configåˆæ¢ç¯‡</a>
                            <p>å‰è¨€ å¬è¿‡æ¸¸æˆæ•°å€¼ç­–åˆ’å²—ä½çš„,éƒ½çŸ¥é“ä»–ä»¬æ˜¯ä¸ºäº†æ¸¸æˆæ•°å€¼çš„å¹³è¡¡å’Œåˆ¶å®š,æ¸¸æˆä¸­å„ç§å…¬å¼çš„è®¾è®¡,ä»¥åŠæ•´ä¸ªç³»ç»Ÿ...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Gameframework-Config%E5%88%9D%E6%8E%A2%E7%AF%87/" title="Gameframework-Configåˆæ¢ç¯‡">
                            <img class="relateimg" src="/img/title/Gameframework/wallhaven_15.jpg" alt="Gameframework-Configåˆæ¢ç¯‡">
                        </a>
                    </li>
                    
                
            
        </ul>
    </div>
</div>
    
  <div class="post-comment" style="max-width:720px;margin: 0 auto;background:transparent;background-color:rgba(255,255,255,0.8);" id="single">
    
    <img src="/img/inner/icon-comment.png" style="display:inline-block;vertical-align:middle;"/>
    <span style="font-size: 22px;font-weight: 700;vertical-align:middle;"> è¯„è®º </span>
    <div id="vcomments">
        <script type="text/javascript">
            $.getScript('/js/Valine.min.js', function() {
              new Valine({
                el: '#vcomments' ,
                appId: 'qzl794vHGf8vva0aofpshidh-gzGzoHsz',
                appKey: 'r9iB1MRnpaWEdKfUkk2FhWtg',
                notify: 'false', 
                verify: 'false', 
                avatar:'robohash', 
                placeholder: 'å°é—®å·ä½ æ˜¯å¦æœ‰å¾ˆå¤šæœ‹å‹ï¼Ÿ(æ³¨:å›å¤ä¼šé€šè¿‡é‚®ç®±é€šçŸ¥,å¡«å†™é‚®ç®±æ‰å¯ç”Ÿæ•ˆã€‚)',
                visitor: 'true'
            });
          });
        </script>       
    </div>
  </div>
<script src="https://s3.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
	
var siteTitle = "æ˜Ÿç©ºåŸä¸‹æ— å›ç‹";
var homePage = "https://daveant.github.io/";

var userAgentInfo = navigator.userAgent;
var Agents = ["Android", "iPhone",
    "SymbianOS", "Windows Phone", "iPod"];
var isMobile = false;
for (var v = 0; v < Agents.length; v++) {
	if (userAgentInfo.indexOf(Agents[v]) > 0) {
	  isMobile = true;
	  break;
	}
}
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            TAGS: 'ä¾¿ç­¾',
        },
        ROOT_URL: "https://daveant.github.io/",
        CONTENT_URL: '/lunr.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);	

</script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<script src="/js/wallpaperDefine.js"></script>
<script src="/js/InsightSearch.js"></script>
<script src="/js/live2d-main.js"></script>
<script src="/js/waifu-tips.js"></script>
<script src="/js/wallhaven.js"></script></body>
</html>

