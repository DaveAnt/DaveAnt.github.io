<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate">
  <title>64位和32位程序的区别 &middot; 星空城下无君王</title>
  <meta name="keywords" content="星空城下无君王, GF教程, ET教程, XLua教程, Unity游戏开发教程">
  <meta name="description" content="DaveAnt的游戏开发分享站">
  <meta name="author" content="DaveAnt">
  <link rel="icon" type="image/png" href="https://daveant.github.io/favicon.ico">
  <link rel="stylesheet" href="/css/diaspora.css">
  <link rel="stylesheet" href="/css/insight.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/waifu.css">
  <link rel="stylesheet" href="/css/qplayer.css">
  <link rel="stylesheet" href="/css/qplayer.init.css">
  <script src="/js/qplayer.js"></script>
  <script src="/js/qplayer.init.js"></script>  
</head>
<div class="waifu">
<div class="waifu-tips"></div>
<div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-top"></span>
    <span class="fui-chat"></span>
    <span class="fui-user"></span>
    <span class="fui-eye"></span>
    <span class="fui-cross"></span>
</div>
</div><body class="loading">
        <div id="loading"></div>
				<div id="nav"></div>
				<div class="nav-user"></div>
	
	
	
	
	
	
		<div class="toc-container" id="single">
		    <div class="toc">
				<aside class="toc-list">
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#%e5%89%8d%e8%a8%80">
				                            前言
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98">
				                            1.出现问题
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#2%e5%90%af%e7%94%a8%e7%bb%88%e6%9e%81%e6%96%b9%e6%a1%88">
				                            2.启用终极方案
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				        
				            
				                
				                
				                    
				                    <ul>
				                    
				                    <ul>
				                    
				                    
				                        <li>
				                            <a class="toc-link" href="#3%e5%88%86%e6%9e%90%e5%8c%ba%e5%88%ab">
				                            3.分析区别
				                            </a>
				                        </li>
				                    
				                    </ul>
				                    
				                    </ul>
				                    
				                
				            
				        
				</aside>
		    </div>
		</div>
	

    <div id="single">
    <div id="top" style="display: block;">
        <div class="bar">
        </div>
        <a title="返回首页" class="icon-home" href="javascript:history.back()"></a>
        <div title="播放/暂停" class="icon-play">
        </div>
        
        <h3 class="subtitle" style="display: none;">
        64位和32位程序的区别</h3>
        <div class="social">
            <div>
                <div class="share">
                    <a title="打赏作者[微信]" class="icon-wechat" href="javascript:;"></a>
                    <a title="打赏作者[支付宝]" class="icon-alipay" href="javascript:;"></a>
                </div>
                <div id="wechatpay"> <img src="/img/inner/wechatpay.jpg"/> </div>
                <div id="alipay"> <img src="/img/inner/alipay.jpg"/> </div>
            </div>
        </div>
        <div class="scrollbar" style="width: 1.1636%;"></div>
    </div>
    <div class="section">
        <div class="article">
            <div style="background:transparent;background-color:rgba(255,255,255,0.8);">
                <h1 class="title">
                64位和32位程序的区别</h1>
                <div class="stuff">
                    <span>April 3, 2020</span>
                    <span>字数 1466</span>
                                  
                    <span id="/posts/64位和32位程序的区别/" class="leancloud_visitors" data-flag-title="64位和32位程序的区别">
                        <i class="leancloud-visitors-count">极速模式</i>
                    </span>
                    
                </div>
                <div class="content">
                    <!--cover: /img/title/Must/wallhaven_3.jpg
cover: https://pics.images.ac.cn/image/5eb551e3ef687.html-->
<h2 id="前言">前言</h2>
<blockquote>
<p>记得很久以前老大和我说:小明(这里的小明不是课本上的小明)你把这个功能迁移到64位的程序上(ps:之前是32位的)。这个东西很简单嘛,Ctrl-C和Ctrl-V就可以处理好了,这个任务很适合我这种脑子比较愚笨的,哈哈哈哈,经过一段时间猛如虎的操作,于是我和程序位数出现了奇缘。</p>
</blockquote>
<h2 id="1出现问题">1.出现问题</h2>
<p>看到标题应该知道了,我竟然移植失败了???把功能移植上去以后程序启动不起来,卧槽勒,第一个反应就是怀疑运行环境在秀我,通常遇到这情况就马上重启(开玩笑的,马上debug看看到底什么地方出现问题,于是开始不能自理了),two hour later,找到类似以下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>	TMapHeader <span style="color:#f92672">=</span> record
</span></span><span style="display:flex;"><span>		title: array[<span style="color:#ae81ff">0</span> .. <span style="color:#ae81ff">31</span>] of AnsiChar;
</span></span><span style="display:flex;"><span>		idxCount: Integer;<span style="color:#75715e">//索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		dataMap: TList;
</span></span><span style="display:flex;"><span>		...
</span></span><span style="display:flex;"><span>	end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	m_struct.title :<span style="color:#f92672">=</span> p_struct<span style="color:#f92672">^</span>.title;  
</span></span><span style="display:flex;"><span>	m_struct.idxCount :<span style="color:#f92672">=</span> p_struct<span style="color:#f92672">^</span>.idxCount;
</span></span><span style="display:flex;"><span>	...
</span></span></code></pre></div><p>这个语言是delphi(比较古老的语言了,不要在意),反正就是关于结构体赋值操作出现的问题,突然想到了什么,64位的程序和32位程序的值类型的大小可能是不一样的,比如double在64位程序里是8字节,在32位程序里是8字节;int在64位程序是4字节的,在32位程序是4字节的&hellip;
<img src="/img/post/Must/64or32/look1.jpg" alt="look1">
眉头一皱感觉事情好像没有想象的简单&hellip;经过对比发现字节大小都是一致,又经过一段时间的冥思苦想,one hour later&hellip;要死了要死了,断点发现赋值前数据就已经出现问题了,找到数据读取的代码,看看是不是移植时手滑了一下下才导致的问题(安慰自己中&hellip;),还是没有发现问题,当时背后冷汗就下来了,如此简单的事情搞不定,老大不会把我杀了祭天吧&hellip;</p>
<h2 id="2启用终极方案">2.启用终极方案</h2>
<p>什么是终极方案呢？终极方案就是向老大寻求帮助(虽然老大日理万机,每秒钟几十亿上下还是过来帮我看了一下&hellip;),只看老大往椅子上一坐经过10多秒钟就发现错误了,编程的水平果然已经到了老奸巨猾的地步,原因是TList本质上是指针,在64位下是8字节的,在32位下是4字节的,然后开始说这个结构体是谁定义的,为什么把需要保存数据的结构体里放个指针,毫无意义,导致读取数据的时候出现偏移。嗯&hellip;,写这个功能的前辈已经离职了。已经知道原因就可以调整了,数据读取时判断一下如果是64位程序就强制少偏移4字节(sizeof(tlist) - 4差不多这个意思&hellip;),感觉有点气,debug时间是比较长,但差点就靠自己解决这个bug了。
<img src="/img/post/Must/64or32/look2.jpg" alt="look2"></p>
<h2 id="3分析区别">3.分析区别</h2>
<p>1.64位和32位有什么区别？</p>
<ul>
<li>64位CPU拥有更大的寻址能力,最大支持到16GB内存,而32位只支持4G内存。</li>
<li>64位CPU一次可提取64位数据,比32位提高了一倍,理论上性能会提升1倍。但这是建立在64bit操作系统,64bit软件的基础上的。</li>
</ul>
<p>2.数据类型对应的字节数</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>32位编译器</th>
<th>64位编译器</th>
</tr>
</thead>
<tbody>
<tr>
<td>char</td>
<td>1字节</td>
<td>1字节</td>
</tr>
<tr>
<td>int</td>
<td>4字节</td>
<td>4字节</td>
</tr>
<tr>
<td>int *</td>
<td>4字节</td>
<td>8字节</td>
</tr>
<tr>
<td>float</td>
<td>4字节</td>
<td>4字节</td>
</tr>
<tr>
<td>double</td>
<td>8字节</td>
<td>8字节</td>
</tr>
<tr>
<td>long long</td>
<td>8字节</td>
<td>8字节</td>
</tr>
<tr>
<td>class</td>
<td>4字节</td>
<td>8字节</td>
</tr>
</tbody>
</table>
<p>经过表格对比发现字节大小不同的就是指针,class是引用类型说明其实也是指针(各位可以去sizeof(class)一下就知道了),至于struct存在字节对齐问题,这个自行研究,结果就是注意指针在不同位数程序的字节,因为在不同位数程序里指针字节大小一定不同,它们字节大小完全和程序的位数一致,换句话说可以通过sizeof(void *)去判断当前程序是几位的,当然16位可能和32或64位存在着其他值类型字节的不同。最后就是心中无招胜有招,类似这种问题出错时可以进行对比排查错误,有struct就进去看看有没有类似指针变量,如果有class就直接说明字节大小是不同。</p>

                    <audio id="audio" loop="1" preload="auto" style="width: 100%;" controls="controls">
                        <source type="audio/mpeg" src="/mp3/%e5%a5%b9%e6%9b%be%e6%b4%bb%e8%bf%87%e5%95%8a.mp3">
                        <a href="/mp3/%e5%a5%b9%e6%9b%be%e6%b4%bb%e8%bf%87%e5%95%8a.mp3">/mp3/她曾活过啊.mp3</a>
                    </audio>
                </div>
            </div>
        </div>
    </div>
    <div class="relate">
        <ul >
            <h3 id="prev_next">
                <em>相 关 文 章</em>
                <span>
                    <a href="javascript: window.scrollTo(0, 0);">
                    返回顶部</a>
                    
                        <a href="https://daveant.github.io/posts/%E4%BB%80%E4%B9%88%E6%98%AFDrawCall/" rel="prev">上一篇</a>
                    
                    
                        <a href="https://daveant.github.io/posts/%E6%B8%B8%E6%88%8F%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%A6/" rel="next">下一篇</a>
                    
                </span>
            </h3>
            
            
            
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81%E5%92%8C%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="编码解码和协议分析">
                            编码解码和协议分析</a>
                            <p>前言 计算器显示的字符最终存在内存里都是以二进制码形式的,最开始的计算机字符用ASCII编码去存储,A...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81%E5%92%8C%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="编码解码和协议分析">
                            <img class="relateimg" src="/img/title/Must/wallhaven_1.jpg" alt="编码解码和协议分析">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/CSharp%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3/" title="CSharp特性详解">
                            CSharp特性详解</a>
                            <p>前言 CSharp的特性(Attribute)是比较难以理解的技术,写代码时通常都要求写注释,为了是让...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/CSharp%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3/" title="CSharp特性详解">
                            <img class="relateimg" src="/img/title/Must/wallhaven_7.jpg" alt="CSharp特性详解">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/Socket%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="Socket基础知识">
                            Socket基础知识</a>
                            <p>前言 所谓套接字(Socket),就是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象。套接字...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/Socket%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="Socket基础知识">
                            <img class="relateimg" src="/img/title/Must/wallhaven_5.jpg" alt="Socket基础知识">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/CSharp%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="CSharp中的多线程">
                            CSharp中的多线程</a>
                            <p>1.相关概念 进程 是Windows系统中的基本概念,它包含着运行程序所需要的资源。正在运行的应用程序在...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/CSharp%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="CSharp中的多线程">
                            <img class="relateimg" src="/img/title/Must/wallhaven_6.jpg" alt="CSharp中的多线程">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="https://daveant.github.io/posts/%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/" title="坐标空间变换">
                            坐标空间变换</a>
                            <p>前言 这是比较冷门的知识点,为什么需要不同坐标空间？在游戏开发时有很多不同的坐标空间定义,比如模型空间...</p>
                        </div>
                        
                        <a href="https://daveant.github.io/posts/%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/" title="坐标空间变换">
                            <img class="relateimg" src="/img/title/Must/wallhaven_4.jpg" alt="坐标空间变换">
                        </a>
                    </li>
                    
                
            
        </ul>
    </div>
</div>
    
  <div class="post-comment" style="max-width:720px;margin: 0 auto;background:transparent;background-color:rgba(255,255,255,0.8);" id="single">
    
    <img src="/img/inner/icon-comment.png" style="display:inline-block;vertical-align:middle;"/>
    <span style="font-size: 22px;font-weight: 700;vertical-align:middle;"> 评论 </span>
    <div id="vcomments">
        <script type="text/javascript">
            $.getScript('/js/Valine.min.js', function() {
              new Valine({
                el: '#vcomments' ,
                appId: 'qzl794vHGf8vva0aofpshidh-gzGzoHsz',
                appKey: 'r9iB1MRnpaWEdKfUkk2FhWtg',
                notify: 'false', 
                verify: 'false', 
                avatar:'robohash', 
                placeholder: '小问号你是否有很多朋友？(注:回复会通过邮箱通知,填写邮箱才可生效。)',
                visitor: 'true'
            });
          });
        </script>       
    </div>
  </div>
<script src="https://s3.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
	
var siteTitle = "星空城下无君王";
var homePage = "https://daveant.github.io/";

var userAgentInfo = navigator.userAgent;
var Agents = ["Android", "iPhone",
    "SymbianOS", "Windows Phone", "iPod"];
var isMobile = false;
for (var v = 0; v < Agents.length; v++) {
	if (userAgentInfo.indexOf(Agents[v]) > 0) {
	  isMobile = true;
	  break;
	}
}
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            TAGS: '便签',
        },
        ROOT_URL: "https://daveant.github.io/",
        CONTENT_URL: '/lunr.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);	

</script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<script src="/js/wallpaperDefine.js"></script>
<script src="/js/InsightSearch.js"></script>
<script src="/js/live2d-main.js"></script>
<script src="/js/waifu-tips.js"></script>
<script src="/js/wallhaven.js"></script></body>
</html>

